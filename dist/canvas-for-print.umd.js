!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).CanvasForPrint=t()}(this,(function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var t={};
/*! streamsaver. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */
!function(e){var t;t=()=>{const e="object"==typeof window?window:this;e.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let t=null,n=!1;const i=e.WebStreamsPolyfill||{},r=e.isSecureContext;let a=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const o=r||"MozAppearance"in document.documentElement.style?"iframe":"navigate",s={createWriteStream:function(i,d,c){let m={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},u=0,p=null,h=null,g=null;if(Number.isFinite(d)?([c,d]=[d,c],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),m.size=c,m.writableStrategy=d):d&&d.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),m.size=c,m.writableStrategy=d):m=d||{},!a){t||(t=r?l(s.mitm):function(t){const n="width=200,height=100",i=document.createDocumentFragment(),r={frame:e.open(t,"popup",n),loaded:!1,isIframe:!1,isPopup:!0,remove(){r.frame.close()},addEventListener(...e){i.addEventListener(...e)},dispatchEvent(...e){i.dispatchEvent(...e)},removeEventListener(...e){i.removeEventListener(...e)},postMessage(...e){r.frame.postMessage(...e)}},a=t=>{t.source===r.frame&&(r.loaded=!0,e.removeEventListener("message",a),r.dispatchEvent(new Event("load")))};return e.addEventListener("message",a),r}(s.mitm)),h=new MessageChannel,i=encodeURIComponent(i.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const a={transferringReadable:n,pathname:m.pathname||Math.random().toString().slice(-6)+"/"+i,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+i}};m.size&&(a.headers["Content-Length"]=m.size);const d=[a,"*",[h.port2]];if(n){const e="iframe"===o?void 0:{transform(e,t){if(!(e instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");u+=e.length,t.enqueue(e),p&&(location.href=p,p=null)},flush(){p&&(location.href=p)}};g=new s.TransformStream(e,m.writableStrategy,m.readableStrategy);const t=g.readable;h.port1.postMessage({readableStream:t},[t])}h.port1.onmessage=e=>{e.data.download?"navigate"===o?(t.remove(),t=null,u?location.href=e.data.download:p=e.data.download):(t.isPopup&&(t.remove(),t=null,"iframe"===o&&l(s.mitm)),l(e.data.download)):e.data.abort&&(f=[],h.port1.postMessage("abort"),h.port1.onmessage=null,h.port1.close(),h.port2.close(),h=null)},t.loaded?t.postMessage(...d):t.addEventListener("load",(()=>{t.postMessage(...d)}),{once:!0})}let f=[];return!a&&g&&g.writable||new s.WritableStream({write(e){if(!(e instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");a?f.push(e):(h.port1.postMessage(e),u+=e.length,p&&(location.href=p,p=null))},close(){if(a){const e=new Blob(f,{type:"application/octet-stream; charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=i,t.click()}else h.port1.postMessage("end")},abort(){f=[],h.port1.postMessage("abort"),h.port1.onmessage=null,h.port1.close(),h.port2.close(),h=null}},m.writableStrategy)},WritableStream:e.WritableStream||i.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function l(e){if(!e)throw new Error("meh");const t=document.createElement("iframe");return t.hidden=!0,t.src=e,t.loaded=!1,t.name="iframe",t.isIframe=!0,t.postMessage=(...e)=>t.contentWindow.postMessage(...e),t.addEventListener("load",(()=>{t.loaded=!0}),{once:!0}),document.body.appendChild(t),t}try{new Response(new ReadableStream),r&&!("serviceWorker"in navigator)&&(a=!0)}catch(e){a=!0}return(e=>{try{e()}catch(e){}})((()=>{const{readable:e}=new TransformStream,t=new MessageChannel;t.port1.postMessage(e,[e]),t.port1.close(),t.port2.close(),n=!0,Object.defineProperty(s,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})})),s},e.exports=t()}({get exports(){return t},set exports(e){t=e}});var n=e({__proto__:null,default:t},[t]);const i=[{unit:"mm",multipleToInches:25.4,label:"millimeters"},{unit:"cm",multipleToInches:2.54,label:"centimeters"},{unit:"dm",multipleToInches:.254,label:"decimeters"},{unit:"m",multipleToInches:.0254,label:"meters"},{unit:"in",multipleToInches:1,label:"inches"}],r=()=>{document.body.style.minHeight=window.innerHeight,document.body.style.minWidth=window.innerWidth},a=(e={width:width,height:height,CANVASP:n,container:container,unit:unit,dpi:dpi,ratio:ratio})=>{let t={...e,widthInPixels:0,heightInPixels:0};const n=t.CANVASP,a=()=>{[t.widthInPixels,t.heightInPixels,t.ratio]=(({unit:e,width:t,height:n,dpi:r,ratio:a})=>{let o=1;for(let t in i)if(e==i[t].unit){o=i[t].multipleToInches;break}return[t=t/o*r,n=n/o*r,t/n]})({...t});return((e,t)=>{const n=getComputedStyle(t),i=parseFloat(n.width);let a=parseFloat(n.height);const o=window.innerWidth,s=window.innerHeight;let l,d;return 0==a&&(t.style.height=window.innerHeight+"px",t.style.overflowY="hidden",a=t.offsetHeight),r(),d=Math.min(s,a),l=d*e,l>o&&(l=Math.min(o,i),d=l/e),{width:l,height:d}})(t.ratio,t.container)};return{init:()=>{},setSize:()=>{const e=a();n.width=t.widthInPixels,n.height=t.heightInPixels,n.style.width=e.width+"px",n.style.height=e.height+"px"},getCanvasSize:()=>({width:t.widthInPixels,height:t.heightInPixels})}};var o={p5Mode:!1,elem:document.createElement("canvas"),width:210,height:297,dpi:300,widthInPixels:null,heightInPixels:null,unit:"mm",ratio:null,mode:"picture",recordingFrames:{start:0,end:100,current:0},container:document.body,id:"canvas-for-print",pixelDensity:window.devicePixelRatio,context:"2d",timeoutBetweenSavingFrames:100,fileName:"test"};const s=()=>{const e=document.createElement("div"),t=document.createElement("button"),n=document.createElement("div"),i=document.createElement("button");let r=!1;r&&e.classList.add("hide");const a=()=>{document.body.appendChild(e),e.appendChild(n),e.appendChild(t),e.appendChild(i),t.setAttribute("id","canvaspdflib_gui-display-button"),e.setAttribute("id","canvaspdflib_gui-container"),n.setAttribute("id","canvaspdflib_gui-infos-container"),i.setAttribute("id","canvaspdflib_gui-save-button"),t.innerHTML="<div><p>open</p></div>",i.innerHTML="<p>save</p>",t.addEventListener("click",d),t.addEventListener("mouseenter",o),t.addEventListener("mouseleave",s)},o=()=>{r&&e.classList.add("canvaspdflib_button-is-hover")},s=()=>{if(r){const e=document.getElementsByClassName("canvaspdflib_button-is-hover");if(e.length>0)for(let t in e)"object"==typeof e[t]&&e[t].classList.remove("canvaspdflib_button-is-hover")}},l=e=>{n.innerHTML="<p> "+e.width+" "+e.unit+" × "+e.height+" "+e.unit+"<br/>"+e.dpi+" dpi</p>"},d=()=>{r?(e.classList.remove("hide"),setTimeout((()=>{t.innerHTML="<div><p>close</p></div>"}),250)):(setTimeout((()=>{t.innerHTML="<div><p>open</p></div>"}),250),e.classList.add("hide")),r=!r};return a(),{init:a,update:({...e})=>{l(e)},saveButton:i}};return e=>{let i={...o,...e};const r=i.elem,l=s(),d=l.saveButton,c=r.getContext(i.context),m=[],u=(e,t)=>{const n=m[e];n&&n.forEach((e=>{e.call(null,t)}))},p=a({width:i.width,height:i.height,unit:i.unit,dpi:i.dpi,ratio:i.ratio,CANVASP:r,container:i.container}),h=async()=>{const e="sequence"==i.mode?i.fileName+"-"+i.recordingFrames.current:i.fileName;u("saving",i),("picture"===i.mode||"sequence"===i.mode&&i.recordingFrames.current>=i.recordingFrames.start&&i.recordingFrames.current<=i.recordingFrames.end)&&(await(async e=>{console.log(n),console.log("Enter in save File");const i=document.getElementById("canvas-for-print");return new Promise(((n,r)=>{i.toBlob((i=>{const r=new Blob([i],{type:"image/png"}),a=t.createWriteStream(e+".png",{size:r.size}),o=r.stream();if(window.WritableStream&&o.pipeTo)return o.pipeTo(a).then((()=>{n(),console.log("it's done")}));window.writer=a.getWriter(),o.getReader()}))}))})(e),"sequence"===i.mode&&setTimeout((()=>{u("saveNextFrame",i)}),i.timeoutBetweenSavingFrames)),"picture"===i.mode?u("saved",i):"sequence"===i.mode&&(i.recordingFrames.current+=1,i.recordingFrames.current>i.recordingFrames.end&&u("saved",i))},g=()=>{r.id=i.id,i.container.appendChild(r)};return window.onresize=()=>{p.setSize();const{width:e,height:t}=p.getCanvasSize();i.widthInPixels=e,i.heightInPixels=t,l.update({...i})},(()=>{p.setSize();const{width:e,height:t}=p.getCanvasSize();i.widthInPixels=e,i.heightInPixels=t,g(),l.init(),l.update({...i}),d.addEventListener("click",h)})(),{...i,on:(e,t)=>(m[e]||(m[e]=[]),m[e].push(t),()=>{m[e]=m[e].filter((e=>t!==e))}),saveCanvas:()=>{h()},ctx:c}}}));
//# sourceMappingURL=canvas-for-print.umd.js.map
