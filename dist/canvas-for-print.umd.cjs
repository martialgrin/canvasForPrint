(function(E,b){typeof exports=="object"&&typeof module<"u"?b(exports):typeof define=="function"&&define.amd?define(["exports"],b):(E=typeof globalThis<"u"?globalThis:E||self,b(E["Canvas For Print"]={}))})(this,function(E){"use strict";var b={},z={get exports(){return b},set exports(o){b=o}};/*! streamsaver. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */(function(o){((e,t)=>{o.exports=t()})("streamSaver",()=>{const e=typeof window=="object"?window:this;e.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let t=null,s=!1;const r=i=>{try{i()}catch{}},p=e.WebStreamsPolyfill||{},a=e.isSecureContext;let l=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const g=a||"MozAppearance"in document.documentElement.style?"iframe":"navigate",f={createWriteStream:S,WritableStream:e.WritableStream||p.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function v(i){if(!i)throw new Error("meh");const n=document.createElement("iframe");return n.hidden=!0,n.src=i,n.loaded=!1,n.name="iframe",n.isIframe=!0,n.postMessage=(...h)=>n.contentWindow.postMessage(...h),n.addEventListener("load",()=>{n.loaded=!0},{once:!0}),document.body.appendChild(n),n}function P(i){const n="width=200,height=100",h=document.createDocumentFragment(),c={frame:e.open(i,"popup",n),loaded:!1,isIframe:!1,isPopup:!0,remove(){c.frame.close()},addEventListener(...m){h.addEventListener(...m)},dispatchEvent(...m){h.dispatchEvent(...m)},removeEventListener(...m){h.removeEventListener(...m)},postMessage(...m){c.frame.postMessage(...m)}},T=m=>{m.source===c.frame&&(c.loaded=!0,e.removeEventListener("message",T),c.dispatchEvent(new Event("load")))};return e.addEventListener("message",T),c}try{new Response(new ReadableStream),a&&!("serviceWorker"in navigator)&&(l=!0)}catch{l=!0}r(()=>{const{readable:i}=new TransformStream,n=new MessageChannel;n.port1.postMessage(i,[i]),n.port1.close(),n.port2.close(),s=!0,Object.defineProperty(f,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})});function d(){t||(t=a?v(f.mitm):P(f.mitm))}function S(i,n,h){let c={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},T=0,m=null,u=null,L=null;if(Number.isFinite(n)?([h,n]=[n,h],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),c.size=h,c.writableStrategy=n):n&&n.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),c.size=h,c.writableStrategy=n):c=n||{},!l){d(),u=new MessageChannel,i=encodeURIComponent(i.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const w={transferringReadable:s,pathname:c.pathname||Math.random().toString().slice(-6)+"/"+i,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+i}};c.size&&(w.headers["Content-Length"]=c.size);const x=[w,"*",[u.port2]];if(s){const y=g==="iframe"?void 0:{transform(I,_){if(!(I instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");T+=I.length,_.enqueue(I),m&&(location.href=m,m=null)},flush(){m&&(location.href=m)}};L=new f.TransformStream(y,c.writableStrategy,c.readableStrategy);const W=L.readable;u.port1.postMessage({readableStream:W},[W])}u.port1.onmessage=y=>{y.data.download?g==="navigate"?(t.remove(),t=null,T?location.href=y.data.download:m=y.data.download):(t.isPopup&&(t.remove(),t=null,g==="iframe"&&v(f.mitm)),v(y.data.download)):y.data.abort&&(M=[],u.port1.postMessage("abort"),u.port1.onmessage=null,u.port1.close(),u.port2.close(),u=null)},t.loaded?t.postMessage(...x):t.addEventListener("load",()=>{t.postMessage(...x)},{once:!0})}let M=[];return!l&&L&&L.writable||new f.WritableStream({write(w){if(!(w instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");if(l){M.push(w);return}u.port1.postMessage(w),T+=w.length,m&&(location.href=m,m=null)},close(){if(l){const w=new Blob(M,{type:"application/octet-stream; charset=utf-8"}),x=document.createElement("a");x.href=URL.createObjectURL(w),x.download=i,x.click()}else u.port1.postMessage("end")},abort(){M=[],u.port1.postMessage("abort"),u.port1.onmessage=null,u.port1.close(),u.port2.close(),u=null}},c.writableStrategy)}return f})})(z);const H=b,A=async()=>{console.log("WEnter in save File");const o=document.getElementById("canvas-for-print");return new Promise((e,t)=>{o.toBlob(s=>{const r=new Blob([s],{type:"image/png"}),p=H.createWriteStream("sample.png",{size:r.size}),a=r.stream();if(window.WritableStream&&a.pipeTo)return a.pipeTo(p).then(()=>{e(),console.log("it's done")});window.writer=p.getWriter(),a.getReader()})})},C=[{unit:"mm",multipleToInches:25.4,label:"millimeters"},{unit:"cm",multipleToInches:2.54,label:"centimeters"},{unit:"dm",multipleToInches:.254,label:"decimeters"},{unit:"m",multipleToInches:.0254,label:"meters"},{unit:"in",multipleToInches:1,label:"inches"}],F=({unit:o,width:e,height:t,dpi:s,ratio:r})=>{let p=1;for(let a in C)if(o==C[a].unit){p=C[a].multipleToInches;break}return e=e/p*s,t=t/p*s,r=e/t,[e,t,r]},j=(o,e)=>{const t=getComputedStyle(e),s=parseFloat(t.width);let r=parseFloat(t.height);const p=window.innerWidth,a=window.innerHeight;r==0&&(e.style.height=window.innerHeight+"px",e.style.overflowY="hidden",r=e.offsetHeight),U();let l,g;return g=Math.min(a,r),l=g*o,l>p&&(l=Math.min(p,s),g=l/o),{width:l,height:g}},U=()=>{document.body.style.minHeight=window.innerHeight,document.body.style.minWidth=window.innerWidth},B=(o={width,height,CANVASP,container,unit,dpi,ratio})=>{let e={...o,widthInPixels:0,heightInPixels:0};const t=e.CANVASP,s=()=>{const l=r();t.width=e.widthInPixels,t.height=e.heightInPixels,t.style.width=l.width+"px",t.style.height=l.height+"px"},r=()=>([e.widthInPixels,e.heightInPixels,e.ratio]=F({...e}),j(e.ratio,e.container));return{init:()=>{},setSize:s,getCanvasSize:()=>({width:e.widthInPixels,height:e.heightInPixels})}},R={elem:document.createElement("canvas"),width:210,height:297,dpi:300,widthInPixels:null,heightInPixels:null,unit:"mm",ratio:null,container:document.body,id:"canvas-for-print",pixelDensity:window.devicePixelRatio,context:"2d",bleeds:!1},V="",k=()=>{const o=document.createElement("div"),e=document.createElement("button"),t=document.createElement("div"),s=document.createElement("button");let r=!1;r&&o.classList.add("hide");const p=()=>{e.addEventListener("click",P),e.addEventListener("mouseenter",l),e.addEventListener("mouseleave",g)},a=()=>{document.body.appendChild(o),o.appendChild(t),o.appendChild(e),o.appendChild(s),e.setAttribute("id","canvaspdflib_gui-display-button"),o.setAttribute("id","gui-container"),t.setAttribute("id","canvaspdflib_gui-infos-container"),s.setAttribute("id","canvaspdflib_gui-save-button"),e.innerHTML="<div><p>open</p></div>",s.innerHTML="<p>save</p>",p()},l=()=>{r&&o.classList.add("canvaspdflib_button-is-hover")},g=()=>{if(r){const d=document.getElementsByClassName("canvaspdflib_button-is-hover");if(console.log(d.length),d.length>0)for(let S in d)typeof d[S]=="object"&&(console.log(d[S]),d[S].classList.remove("canvaspdflib_button-is-hover"))}},f=({...d})=>{console.log(d.width),v(d)},v=d=>{t.innerHTML="<p> "+d.width+" "+d.unit+" × "+d.height+" "+d.unit+"<br/>"+d.dpi+" dpi</p>",console.log(d)},P=()=>{r?(o.classList.remove("hide"),setTimeout(()=>{e.innerHTML="<div><p>close</p></div>"},250)):(setTimeout(()=>{e.innerHTML="<div><p>open</p></div>"},250),o.classList.add("hide")),r=!r};return a(),{init:a,update:f,saveButton:s}},D=o=>{let e={...R,...o};const t=e.elem,s=k(),r=s.saveButton,p=t.getContext(e.context),a=[],l=(i,n)=>(a[i]||(a[i]=[]),a[i].push(n),()=>{a[i]=a[i].filter(h=>n!==h)}),g=(i,n)=>{const h=a[i];h&&h.forEach(c=>{c.call(null,n)}),console.log(a)},f=B({width:e.width,height:e.height,unit:e.unit,dpi:e.dpi,ratio:e.ratio,CANVASP:t,container:e.container}),v=()=>{r.addEventListener("click",P)},P=async()=>{g("startSaving","hello"),await A(),g("saved","hello")},d=()=>{f.setSize();const{width:i,height:n}=f.getCanvasSize();return e.widthInPixels=i,e.heightInPixels=n,S(),s.init(),s.update({...e}),v(),{...e}},S=()=>{t.id=e.id,e.container.appendChild(t)};return window.onresize=()=>{f.setSize();const{width:i,height:n}=f.getCanvasSize();e.widthInPixels=i,e.heightInPixels=n,s.update({...e})},d(),{...e,on:l,ctx:p}};E.canvasForPrint=D,Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})});
